!function(t){function e(t){this.parent=t,this.container,this.loadbar,this.percentageContainer}function n(t){this.toPreload=[],this.parent=t,this.container}function o(t){this.element,this.parent=t}function i(o,i){this.element=o,this.$element=t(o),this.options=i,this.foundUrls=[],this.destroyed=!1,this.imageCounter=0,this.imageDone=0,this.alreadyLoaded=!1,this.preloadContainer=new n(this),this.overlayLoader=new e(this),this.defaultOptions={onComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:!1,deepSearch:!0,completeAnimation:"fade",minimumTime:500},this.init()}e.prototype.createOverlay=function(){var e="absolute";if("body"==this.parent.element.tagName.toLowerCase())e="fixed";else{var n=this.parent.$element.css("position");("fixed"!=n||"absolute"!=n)&&this.parent.$element.css("position","relative")}this.container=t("<div id='"+this.parent.options.overlayId+"'></div>").css({width:"100%",height:"100%",backgroundColor:this.parent.options.backgroundColor,backgroundPosition:"fixed",position:e,zIndex:666999,top:0,left:0}).appendTo(this.parent.$element),this.loadbar=t("<div id='qLbar'></div>").css({height:this.parent.options.barHeight+"px",marginTop:"-"+this.parent.options.barHeight/2+"px",backgroundColor:this.parent.options.barColor,width:"0%",position:"absolute",top:"50%"}).appendTo(this.container),1==this.parent.options.percentage&&(this.percentageContainer=t("<div id='qLpercentage'></div>").text("0%").css({height:"40px",width:"100px",position:"absolute",fontSize:"3em",top:"50%",left:"50%",marginTop:"-"+(59+this.parent.options.barHeight)+"px",textAlign:"center",marginLeft:"-50px",color:this.parent.options.barColor}).appendTo(this.container)),this.parent.preloadContainer.toPreload.length&&1!=this.parent.alreadyLoaded||this.parent.destroyContainers()},e.prototype.updatePercentage=function(t){this.loadbar.stop().animate({width:t+"%",minWidth:t+"%"},200),1==this.parent.options.percentage&&this.percentageContainer.text(Math.ceil(t)+"%")},n.prototype.create=function(){this.container=t("<div></div>").appendTo("body").css({display:"none",width:0,height:0,overflow:"hidden"}),this.processQueue()},n.prototype.processQueue=function(){for(var t=0;this.toPreload.length>t;t++)this.parent.destroyed||this.preloadImage(this.toPreload[t])},n.prototype.addImage=function(t){this.toPreload.push(t)},n.prototype.preloadImage=function(t){var e=new o;e.addToPreloader(this,t),e.bindLoadEvent()},o.prototype.addToPreloader=function(e,n){this.element=t("<img />").attr("src",n),this.element.appendTo(e.container),this.parent=e.parent},o.prototype.bindLoadEvent=function(){this.parent.imageCounter++;var t=this.element.attr("src");this.element.removeAttr("src");var e=this;setTimeout(function(){e.element.on("load error",e,function(t){t.data.completeLoading()}),e.element.attr("src",t)},1)},o.prototype.completeLoading=function(){this.parent.imageDone++;var t=100*(this.parent.imageDone/this.parent.imageCounter);this.parent.overlayLoader.updatePercentage(t),this.parent.imageDone==this.parent.imageCounter&&this.parent.endLoader()},i.prototype.init=function(){if(this.options=t.extend({},this.defaultOptions,this.options),this.findImageInElement(this.element),1==this.options.deepSearch)for(var e=this.$element.find("*:not(script)"),n=0;n<e.length;n++)this.findImageInElement(e[n]);this.preloadContainer.create(),this.overlayLoader.createOverlay()},i.prototype.findImageInElement=function(e){var n="",i=t(e),r="normal";if("none"!=i.css("background-image")?(n=i.css("background-image"),r="background"):"undefined"!=typeof i.attr("src")&&"img"==e.nodeName.toLowerCase()&&(n=i.attr("src")),!this.hasGradient(n)){n=this.stripUrl(n);for(var a=n.split(", "),s=0;s<a.length;s++)if(this.validUrl(a[s])&&this.urlIsNew(a[s])){var p="";if(this.isIE()||this.isOpera())p="?rand="+Math.random(),this.preloadContainer.addImage(a[s]+p);else if("background"==r)this.preloadContainer.addImage(a[s]+p);else{var h=new o(this);h.element=i,h.bindLoadEvent()}this.foundUrls.push(a[s])}}},i.prototype.hasGradient=function(t){return-1==t.indexOf("gradient")?!1:!0},i.prototype.stripUrl=function(t){return t=t.replace(/url\(\"/g,""),t=t.replace(/url\(/g,""),t=t.replace(/\"\)/g,""),t=t.replace(/\)/g,"")},i.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)},i.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)},i.prototype.validUrl=function(t){return t.length>0&&!t.match(/^(data:)/i)?!0:!1},i.prototype.urlIsNew=function(t){return-1==this.foundUrls.indexOf(t)?!0:!1},i.prototype.destroyContainers=function(){this.destroyed=!0,this.preloadContainer.container.remove(),this.overlayLoader.container.remove()},i.prototype.endLoader=function(){this.destroyed=!0,this.onLoadComplete()},i.prototype.onLoadComplete=function(){if("grow"==this.options.completeAnimation){var e=500;this.overlayLoader.loadbar[0].parent=this,this.overlayLoader.loadbar.stop().animate({width:"100%"},e,function(){t(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent,this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})})})}else this.overlayLoader.container[0].parent=this,this.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1}),t.fn.queryLoader2=function(t){return this.each(function(){new i(this,t)})}}(jQuery);